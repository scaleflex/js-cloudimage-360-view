{"version":3,"file":"canvas.worker-B3tigaDY.js","sources":["../src/canvas.worker.js"],"sourcesContent":["let canvas, ctx, dpr, drawWidth, drawHeight, wideImage;\n\nself.onmessage = async (event) => {\n  const {\n    action,\n    offscreen,\n    devicePixelRatio,\n    imageData,\n    zoomScale,\n    pointerX,\n    pointerY,\n    imageAspectRatio,\n    containerWidth,\n    containerHeight,\n  } = event.data;\n\n  switch (action) {\n    case 'initCanvas':\n      initCanvas(offscreen, devicePixelRatio);\n      break;\n    case 'adaptCanvasSize':\n      adaptCanvasSize(imageAspectRatio, containerWidth, containerHeight);\n      break;\n    case 'drawImageOnCanvas':\n      drawImageOnCanvas(imageData, zoomScale, pointerX, pointerY);\n      break;\n    default:\n      break;\n  }\n};\n\nconst initCanvas = (offscreenCanvas, devicePixelRatio) => {\n  canvas = offscreenCanvas;\n  ctx = canvas.getContext('2d');\n  dpr = devicePixelRatio;\n};\n\nconst adaptCanvasSize = (imageAspectRatio, containerWidth, containerHeight) => {\n  const containerAspectRatio = containerWidth / containerHeight;\n  wideImage = imageAspectRatio > containerAspectRatio;\n\n  canvas.width = containerWidth * dpr;\n  canvas.height = containerHeight * dpr;\n  ctx.scale(dpr, dpr);\n\n  if (wideImage) {\n    drawWidth = containerWidth;\n    drawHeight = containerWidth / imageAspectRatio;\n  } else {\n    drawHeight = containerHeight;\n    drawWidth = containerHeight * imageAspectRatio;\n  }\n\n  ctx.imageSmoothingEnabled = true;\n  ctx.imageSmoothingQuality = 'high';\n};\n\n// Draw the image on the OffscreenCanvas (always at 1x â€” zoom is CSS transform)\nconst drawImageOnCanvas = (imageData = {}) => {\n  const { bitmapImage } = imageData;\n  if (!canvas || !bitmapImage) return;\n\n  let offsetX, offsetY;\n  if (wideImage) {\n    offsetX = 0;\n    offsetY = (canvas.height / dpr - drawHeight) / 2;\n  } else {\n    offsetX = (canvas.width / dpr - drawWidth) / 2;\n    offsetY = 0;\n  }\n\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.drawImage(bitmapImage, offsetX, offsetY, drawWidth, drawHeight);\n};\n"],"names":["canvas","ctx","dpr","drawWidth","drawHeight","wideImage","event","action","offscreen","devicePixelRatio","imageData","zoomScale","pointerX","pointerY","imageAspectRatio","containerWidth","containerHeight","initCanvas","adaptCanvasSize","drawImageOnCanvas","offscreenCanvas","containerAspectRatio","bitmapImage","offsetX","offsetY"],"mappings":"yBAAA,IAAIA,EAAQC,EAAKC,EAAKC,EAAWC,EAAYC,EAE7C,KAAK,UAAY,MAAOC,GAAU,CAChC,KAAM,CACJ,OAAAC,EACA,UAAAC,EACA,iBAAAC,EACA,UAAAC,EACA,UAAAC,EACA,SAAAC,EACA,SAAAC,EACA,iBAAAC,EACA,eAAAC,EACA,gBAAAC,CACJ,EAAMV,EAAM,KAEV,OAAQC,EAAM,CACZ,IAAK,aACHU,EAAWT,EAAWC,CAAgB,EACtC,MACF,IAAK,kBACHS,EAAgBJ,EAAkBC,EAAgBC,CAAe,EACjE,MACF,IAAK,oBACHG,EAAkBT,CAAwC,EAC1D,KAGN,CACA,EAEA,MAAMO,EAAa,CAACG,EAAiBX,IAAqB,CACxDT,EAASoB,EACTnB,EAAMD,EAAO,WAAW,IAAI,EAC5BE,EAAMO,CACR,EAEMS,EAAkB,CAACJ,EAAkBC,EAAgBC,IAAoB,CAC7E,MAAMK,EAAuBN,EAAiBC,EAC9CX,EAAYS,EAAmBO,EAE/BrB,EAAO,MAAQe,EAAiBb,EAChCF,EAAO,OAASgB,EAAkBd,EAClCD,EAAI,MAAMC,EAAKA,CAAG,EAEdG,GACFF,EAAYY,EACZX,EAAaW,EAAiBD,IAE9BV,EAAaY,EACbb,EAAYa,EAAkBF,GAGhCb,EAAI,sBAAwB,GAC5BA,EAAI,sBAAwB,MAC9B,EAGMkB,EAAoB,CAACT,EAAY,KAAO,CAC5C,KAAM,CAAE,YAAAY,CAAW,EAAKZ,EACxB,GAAI,CAACV,GAAU,CAACsB,EAAa,OAE7B,IAAIC,EAASC,EACTnB,GACFkB,EAAU,EACVC,GAAWxB,EAAO,OAASE,EAAME,GAAc,IAE/CmB,GAAWvB,EAAO,MAAQE,EAAMC,GAAa,EAC7CqB,EAAU,GAGZvB,EAAI,UAAU,EAAG,EAAGD,EAAO,MAAOA,EAAO,MAAM,EAC/CC,EAAI,UAAUqB,EAAaC,EAASC,EAASrB,EAAWC,CAAU,CACpE"}