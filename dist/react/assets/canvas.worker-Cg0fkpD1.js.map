{"version":3,"file":"canvas.worker-Cg0fkpD1.js","sources":["../src/utils/zoom/calculate-zoomed-dimensions.js","../src/utils/zoom/calculate-zoomed-offset.js","../src/canvas.worker.js"],"sourcesContent":["export const calculateZoomedDimensions = (drawWidth, drawHeight, zoomScale) => {\n  const zoomedWidth = drawWidth / zoomScale;\n  const zoomedHeight = drawHeight / zoomScale;\n  return { zoomedWidth, zoomedHeight };\n};\n","export const calculateZoomOffsets = ({\n  pointerX,\n  pointerY,\n  imageData,\n  zoomedWidth,\n  zoomedHeight,\n  drawWidth,\n  drawHeight,\n}) => {\n  const { naturalWidth, naturalHeight } = imageData;\n  let zoomOffsetX = (pointerX / drawWidth) * naturalWidth - zoomedWidth / 2;\n  let zoomOffsetY = (pointerY / drawHeight) * naturalHeight - zoomedHeight / 2;\n\n  // Calculate max offset values\n  const maxOffsetX = Math.max(0, naturalWidth - zoomedWidth);\n  const maxOffsetY = Math.max(0, naturalHeight - zoomedHeight);\n\n  // Clamp zoom offsets to the valid range\n  zoomOffsetX = Math.max(0, Math.min(zoomOffsetX, maxOffsetX));\n  zoomOffsetY = Math.max(0, Math.min(zoomOffsetY, maxOffsetY));\n\n  return { zoomOffsetX, zoomOffsetY };\n};\n","import { calculateZoomedDimensions, calculateZoomOffsets } from './utils';\n\nlet canvas, ctx, dpr, drawWidth, drawHeight, wideImage;\n\nself.onmessage = async (event) => {\n  const {\n    action,\n    offscreen,\n    devicePixelRatio,\n    imageData,\n    zoomScale,\n    pointerX,\n    pointerY,\n    imageAspectRatio,\n    containerWidth,\n    containerHeight,\n  } = event.data;\n\n  switch (action) {\n    case 'initCanvas':\n      initCanvas(offscreen, devicePixelRatio);\n      break;\n    case 'adaptCanvasSize':\n      adaptCanvasSize(imageAspectRatio, containerWidth, containerHeight);\n      break;\n    case 'drawImageOnCanvas':\n      drawImageOnCanvas(imageData, zoomScale, pointerX, pointerY);\n      break;\n    default:\n      break;\n  }\n};\n\nconst initCanvas = (offscreenCanvas, devicePixelRatio) => {\n  canvas = offscreenCanvas;\n  ctx = canvas.getContext('2d');\n  dpr = devicePixelRatio;\n};\n\nconst adaptCanvasSize = (imageAspectRatio, containerWidth, containerHeight) => {\n  const containerAspectRatio = containerWidth / containerHeight;\n  wideImage = imageAspectRatio > containerAspectRatio;\n\n  canvas.width = containerWidth * dpr;\n  canvas.height = containerHeight * dpr;\n  ctx.scale(dpr, dpr);\n\n  if (wideImage) {\n    drawWidth = containerWidth;\n    drawHeight = containerWidth / imageAspectRatio;\n  } else {\n    drawHeight = containerHeight;\n    drawWidth = containerHeight * imageAspectRatio;\n  }\n\n  ctx.imageSmoothingEnabled = true;\n  ctx.imageSmoothingQuality = 'high';\n};\n\n// Draw the image on the OffscreenCanvas\nconst drawImageOnCanvas = (imageData = {}, zoomScale = 1, pointerX = 0, pointerY = 0) => {\n  const { bitmapImage } = imageData;\n  if (!canvas || !bitmapImage) return;\n\n  let offsetX, offsetY;\n  if (wideImage) {\n    offsetX = 0;\n    offsetY = (canvas.height / dpr - drawHeight) / 2;\n  } else {\n    offsetX = (canvas.width / dpr - drawWidth) / 2;\n    offsetY = 0;\n  }\n\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n  if (zoomScale !== 1) {\n    const { naturalWidth, naturalHeight } = imageData;\n    // Calculate zoomed dimensions using natural image dimensions, not display dimensions\n    const { zoomedWidth, zoomedHeight } = calculateZoomedDimensions(naturalWidth, naturalHeight, zoomScale);\n\n    const { zoomOffsetX, zoomOffsetY } = calculateZoomOffsets({\n      pointerX,\n      pointerY,\n      imageData,\n      zoomedWidth,\n      zoomedHeight,\n      drawWidth,\n      drawHeight,\n    });\n\n    ctx.drawImage(\n      bitmapImage,\n      zoomOffsetX,\n      zoomOffsetY,\n      zoomedWidth,\n      zoomedHeight,\n      offsetX,\n      offsetY,\n      drawWidth,\n      drawHeight\n    );\n  } else {\n    ctx.drawImage(bitmapImage, offsetX, offsetY, drawWidth, drawHeight);\n  }\n};\n"],"names":["calculateZoomedDimensions","drawWidth","drawHeight","zoomScale","zoomedWidth","zoomedHeight","calculateZoomOffsets","pointerX","pointerY","imageData","naturalWidth","naturalHeight","zoomOffsetX","zoomOffsetY","maxOffsetX","maxOffsetY","canvas","ctx","dpr","wideImage","event","action","offscreen","devicePixelRatio","imageAspectRatio","containerWidth","containerHeight","initCanvas","adaptCanvasSize","drawImageOnCanvas","offscreenCanvas","containerAspectRatio","bitmapImage","offsetX","offsetY"],"mappings":"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"}